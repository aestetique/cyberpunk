<form class="{{cssClass}}{{#unless isLocked}} unlocked{{/unless}}" autocomplete="off">
  <div class="character-sheet">
    {{!-- Sheet Frame (880px) --}}
    <div class="sheet-frame">
      {{!-- Header (38px) - Custom borderless header --}}
      <header class="sheet-header">
        <button class="lock-toggle" type="button" title="{{#if isLocked}}Unlock{{else}}Lock{{/if}} Sheet">
          <img src="systems/cyberpunk/img/ui/{{#if isLocked}}lock{{else}}unlock{{/if}}.svg" alt="">
        </button>
        <span class="actor-name">{{actor.name}}</span>
        <a class="header-control" data-action="copyUuid" title="Copy Document UUID">
          <i class="fas fa-passport"></i>
        </a>
        <a class="header-control" data-action="configureSheet" title="Sheet">
          <i class="fas fa-cog"></i>
        </a>
        <a class="header-control" data-action="configureToken" title="Token">
          <i class="fas fa-user-circle"></i>
        </a>
        <a class="header-control close" data-action="closeSheet" title="Close">
          <i class="fas fa-times"></i>
        </a>
      </header>

      {{!-- Content --}}
      <section class="sheet-content">
        {{!-- Left Sidebar (200px) --}}
        <aside class="left-sidebar">
          <div class="portrait-section">
            <div class="portrait-frame">
              <img class="portrait-img" src="{{actor.img}}" title="{{actor.name}}">
            </div>
            <div class="action-buttons">
              <button class="action-btn stun-save" type="button" title="Roll Stun Save">
                <span class="action-btn-name">Shock</span>
                <span class="btn-value">{{stunSaveTotal}}</span>
              </button>
              <button class="action-btn poison-save" type="button" title="Roll Poison Save">
                <span class="action-btn-name">Poison</span>
                <span class="btn-value">{{poisonSaveTotal}}</span>
              </button>
              <button class="action-btn death-save" type="button" title="Roll Death Save">
                <span class="action-btn-name">Death</span>
                <span class="btn-value">{{deathSaveTotal}}</span>
              </button>
            </div>
          </div>

          {{!-- Armor Block (200px Ã— 260px) --}}
          <div class="armor-block">
            <header class="sidebar-header">
              <span class="sidebar-title">ARMOR</span>
              <img class="sidebar-badge" src="systems/cyberpunk/img/ui/badge-armor.svg" alt="">
            </header>

            <div class="armor-content">
              {{!-- Column 1: Left Arm, Left Leg --}}
              <div class="armor-column">
                <div class="armor-slot armor-arm">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/larm-{{armorBlocks.lArm.state}}.svg" alt="Left Arm">
                  {{#unless armorBlocks.lArm.isLost}}
                    {{#if armorBlocks.lArm.sdp}}
                      <span class="armor-sdp{{#if armorBlocks.lArm.isDamaged}} damaged{{/if}}">{{armorBlocks.lArm.sdp}}</span>
                    {{/if}}
                    {{#if armorBlocks.lArm.sp}}
                      <span class="armor-sp armor-sp-arm">{{armorBlocks.lArm.sp}}</span>
                    {{/if}}
                  {{/unless}}
                </div>
                <div class="armor-slot armor-leg">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/lleg-{{armorBlocks.lLeg.state}}.svg" alt="Left Leg">
                  {{#unless armorBlocks.lLeg.isLost}}
                    {{#if armorBlocks.lLeg.sp}}
                      <span class="armor-sp armor-sp-leg">{{armorBlocks.lLeg.sp}}</span>
                    {{/if}}
                    {{#if armorBlocks.lLeg.sdp}}
                      <span class="armor-sdp armor-sdp-leg{{#if armorBlocks.lLeg.isDamaged}} damaged{{/if}}">{{armorBlocks.lLeg.sdp}}</span>
                    {{/if}}
                  {{/unless}}
                </div>
              </div>

              {{!-- Column 2: Head, Torso, BTM --}}
              <div class="armor-column armor-column-center">
                <div class="armor-slot armor-head">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/head-{{armorBlocks.Head.state}}.svg" alt="Head">
                  {{#if armorBlocks.Head.sp}}
                    <span class="armor-sp">{{armorBlocks.Head.sp}}</span>
                  {{/if}}
                </div>
                <div class="armor-slot armor-torso">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/torso-{{armorBlocks.Torso.state}}.svg" alt="Torso">
                  {{#if armorBlocks.Torso.sp}}
                    <span class="armor-sp">{{armorBlocks.Torso.sp}}</span>
                  {{/if}}
                </div>
                <div class="armor-slot armor-btm">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/btm.svg" alt="BTM">
                  {{#if armorBlocks.btm}}
                    <span class="armor-sp">{{armorBlocks.btm}}</span>
                  {{/if}}
                </div>
              </div>

              {{!-- Column 3: Right Arm, Right Leg --}}
              <div class="armor-column">
                <div class="armor-slot armor-arm">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/rarm-{{armorBlocks.rArm.state}}.svg" alt="Right Arm">
                  {{#unless armorBlocks.rArm.isLost}}
                    {{#if armorBlocks.rArm.sdp}}
                      <span class="armor-sdp{{#if armorBlocks.rArm.isDamaged}} damaged{{/if}}">{{armorBlocks.rArm.sdp}}</span>
                    {{/if}}
                    {{#if armorBlocks.rArm.sp}}
                      <span class="armor-sp armor-sp-arm">{{armorBlocks.rArm.sp}}</span>
                    {{/if}}
                  {{/unless}}
                </div>
                <div class="armor-slot armor-leg">
                  <img class="armor-bg" src="systems/cyberpunk/img/armor/rleg-{{armorBlocks.rLeg.state}}.svg" alt="Right Leg">
                  {{#unless armorBlocks.rLeg.isLost}}
                    {{#if armorBlocks.rLeg.sp}}
                      <span class="armor-sp armor-sp-leg">{{armorBlocks.rLeg.sp}}</span>
                    {{/if}}
                    {{#if armorBlocks.rLeg.sdp}}
                      <span class="armor-sdp armor-sdp-leg{{#if armorBlocks.rLeg.isDamaged}} damaged{{/if}}">{{armorBlocks.rLeg.sdp}}</span>
                    {{/if}}
                  {{/unless}}
                </div>
              </div>
            </div>
          </div>
        </aside>

        {{!-- Details (620px) --}}
        <div class="sheet-details" data-group="primary">
          <div class="character-identity">
            <div class="identity-left">
              <input type="text" class="character-name" name="name" value="{{actor.name}}" {{#if isLocked}}readonly{{/if}}>
              <div class="role-display" data-drop-target="role">
                <span class="role-label">{{#if roleLabel}}{{roleLabel}}{{else}}{{localize 'CYBERPUNK.DropRoleHere'}}{{/if}}</span>
                {{#if roleUuid}}
                  <img class="role-view-icon" src="systems/cyberpunk/img/ui/icon-view.svg" alt="View" title="View Role" data-role-uuid="{{roleUuid}}">
                {{/if}}
              </div>
            </div>
            {{#unless isLocked}}
            <div class="identity-points">
              <div class="info-block">
                <span class="info-name">Points</span>
                <span class="info-value">{{charPoints}} / 75</span>
              </div>
              <div class="info-block">
                <span class="info-name">Career</span>
                <span class="info-value">{{careerPoints}} / 40</span>
              </div>
              <div class="info-block">
                <span class="info-name">Pickup</span>
                <span class="info-value">{{pickupPoints}} / {{pickupMax}}</span>
              </div>
            </div>
            {{/unless}}
          </div>

          {{!-- Attributes Row (620px, 16px gap from identity) --}}
          <div class="attributes-row">
            {{#each statButtons as |stat|}}
              {{#if ../isLocked}}
              <button class="stat-btn stat-roll" type="button" data-stat-name="{{stat.key}}" title="{{stat.label}}">
                <span class="stat-name">{{stat.label}}</span>
                <span class="stat-value">{{stat.total}}</span>
              </button>
              {{else}}
              <div class="stat-btn stat-edit">
                <span class="stat-name">{{stat.label}}</span>
                <input type="number" class="stat-value stat-input" name="{{stat.path}}" value="{{stat.base}}" min="1" max="10">
              </div>
              {{/if}}
            {{/each}}
          </div>

          {{!-- Wounds + Humanity Block (620px, 66px, 16px gap from attributes) --}}
          <div class="wounds-humanity-block">
            {{!-- Wounds Row --}}
            <div class="tracker-row wounds-row">
              <img class="tracker-badge" src="systems/cyberpunk/img/ui/badge-wounds.svg" alt="Wounds">
              {{#each woundBlocks as |block|}}
              <div class="tracker-block {{#if block.hasWound}}active{{/if}}">
                <div class="dot-row">
                  {{#each block.dots as |dot|}}
                  <img class="wound-dot"
                       src="systems/cyberpunk/img/ui/wounds-{{dot.state}}.svg"
                       data-damage="{{dot.damage}}"
                       alt="">
                  {{/each}}
                </div>
                <span class="tracker-state wounds-state">{{block.label}}</span>
              </div>
              {{/each}}
            </div>

            {{!-- Humanity Row (click lost dots to restore via therapy) --}}
            <div class="tracker-row humanity-row">
              <img class="tracker-badge" src="systems/cyberpunk/img/ui/badge-humanity.svg" alt="Humanity">
              {{#each humanityBlocks as |block|}}
              <div class="tracker-block {{#if block.active}}active{{/if}} {{#if block.disabled}}disabled{{/if}}">
                <div class="dot-row">
                  {{#each block.dots as |dot|}}
                  <img class="humanity-dot {{#if dot.lost}}lost{{/if}} {{#if dot.disabled}}disabled{{/if}}"
                       src="systems/cyberpunk/img/ui/humanity-{{dot.image}}.svg"
                       data-humanity="{{dot.value}}"
                       title="{{dot.value}}"
                       alt="">
                  {{/each}}
                </div>
                <span class="tracker-state humanity-state">{{block.label}}</span>
              </div>
              {{/each}}
            </div>
          </div>

          {{!-- Info Row (620px, 50px, 16px gap from trackers) --}}
          <div class="info-row">
            {{#each infoBlocks as |info|}}
            <div class="info-block">
              <span class="info-name">{{info.label}}</span>
              {{#if info.editable}}
                {{#if ../isLocked}}
                  <span class="info-value">{{info.displayValue}}</span>
                {{else}}
                  <input type="number" class="info-value info-input" name="{{info.path}}" value="{{info.rawValue}}">
                {{/if}}
              {{else}}
                <span class="info-value">{{info.displayValue}}</span>
              {{/if}}
            </div>
            {{/each}}
          </div>

          {{!-- Tab content areas --}}
          <div class="tab skills" data-group="primary" data-tab="skills">
            {{> "systems/cyberpunk/templates/actor/parts/skills.hbs"}}
          </div>

          <div class="tab gear" data-group="primary" data-tab="gear">
            {{> "systems/cyberpunk/templates/actor/parts/gear.hbs"}}
          </div>

          <div class="tab cyber" data-group="primary" data-tab="cyber">
            {{> "systems/cyberpunk/templates/actor/parts/cyberware.hbs"}}
          </div>

          <div class="tab net" data-group="primary" data-tab="net">
            {{> "systems/cyberpunk/templates/actor/parts/netrunning.hbs"}}
          </div>

          <div class="tab state" data-group="primary" data-tab="state">
            <div class="gear-container">
              <div class="gear-block">
                <header class="tab-header">
                  <span class="tab-title">STATE</span>
                  <img class="tab-badge" src="systems/cyberpunk/img/ui/badge-state.svg" alt="">
                </header>
                <div class="tab-content state-row">
                  {{!-- Stress --}}
                  <div class="state-block">
                    <span class="state-label">Stress</span>
                    <div class="state-value-row">
                      <img class="state-btn state-up" data-field="system.stress" src="systems/cyberpunk/img/ui/badge-up.svg" alt="Increase">
                      <span class="state-value">{{system.stress}}</span>
                      <img class="state-btn state-down" data-field="system.stress" src="systems/cyberpunk/img/ui/badge-down.svg" alt="Decrease">
                    </div>
                    <span class="state-status">{{stressStatus}}</span>
                  </div>
                  {{!-- Fright --}}
                  <div class="state-block">
                    <span class="state-label">Fright</span>
                    <div class="state-value-row">
                      <img class="state-btn state-up" data-field="system.fright" src="systems/cyberpunk/img/ui/badge-up.svg" alt="Increase">
                      <span class="state-value">{{system.fright}}</span>
                      <img class="state-btn state-down" data-field="system.fright" src="systems/cyberpunk/img/ui/badge-down.svg" alt="Decrease">
                    </div>
                    <span class="state-status">{{frightStatus}}</span>
                  </div>
                  {{!-- Fatigue --}}
                  <div class="state-block">
                    <span class="state-label">Fatigue</span>
                    <div class="state-value-row">
                      <img class="state-btn state-up" data-field="system.fatigue" src="systems/cyberpunk/img/ui/badge-up.svg" alt="Increase">
                      <span class="state-value">{{system.fatigue}}</span>
                      <img class="state-btn state-down" data-field="system.fatigue" src="systems/cyberpunk/img/ui/badge-down.svg" alt="Decrease">
                    </div>
                    <span class="state-status">{{fatigueStatus}}</span>
                  </div>
                  {{!-- Wounds --}}
                  <div class="state-block">
                    <span class="state-label">Wounds</span>
                    <div class="state-value-row">
                      <img class="state-btn stabilize-btn" src="systems/cyberpunk/img/ui/badge-stabilize.svg" alt="Stabilize">
                      <span class="state-value">{{system.damage}}</span>
                      <img class="state-btn heal-btn" src="systems/cyberpunk/img/ui/badge-heal.svg" alt="Heal">
                    </div>
                    <span class="state-status">{{woundStatus}}</span>
                  </div>
                </div>
              </div>

              <div class="gear-block">
                <header class="tab-header">
                  <span class="tab-title">COVER</span>
                  <img class="tab-badge" src="systems/cyberpunk/img/ui/badge-cover.svg" alt="">
                </header>
                <div class="cover-row">
                  {{#each coverToggles}}
                  <div class="condition-toggle cover-toggle {{#if this.active}}active{{/if}}" data-cover-key="{{this.key}}">
                    <div class="condition-toggle-icon" style="background-image: url('systems/cyberpunk/img/conditions/cover-{{#if this.active}}on{{else}}off{{/if}}.svg')">
                      <span class="condition-toggle-number">{{this.sp}}</span>
                    </div>
                    <span class="condition-toggle-label">{{this.label}}</span>
                  </div>
                  {{/each}}
                </div>
              </div>

              <div class="gear-block">
                <header class="tab-header">
                  <span class="tab-title">CONDITIONS</span>
                  <img class="tab-badge" src="systems/cyberpunk/img/ui/badge-conditions.svg" alt="">
                </header>
                {{#each conditionToggleRows}}
                <div class="conditions-row">
                  {{#each this}}
                  <div class="condition-toggle cond-toggle {{#if this.active}}active{{/if}}" data-condition-id="{{this.id}}">
                    <div class="condition-toggle-icon" style="background-image: url('systems/cyberpunk/img/conditions/{{this.icon}}-{{#if this.active}}on{{else}}off{{/if}}.svg')">
                    </div>
                    <span class="condition-toggle-label">{{this.label}}</span>
                  </div>
                  {{/each}}
                </div>
                {{/each}}
              </div>
            </div>
          </div>
        </div>
      </section>

      {{!-- Resize Handle (20px) --}}
      <div class="sheet-resize">
        <img src="systems/cyberpunk/img/ui/resize.svg" alt="">
      </div>
    </div>

    {{!-- Tab Selector (50px) --}}
    <nav class="tab-selector" data-group="primary">
      <a class="tab-btn" data-tab="skills" title="Skills">
        <img class="tab-empty" src="systems/cyberpunk/img/ui/tabs-skills-empty.svg" alt="Skills">
        <img class="tab-filled" src="systems/cyberpunk/img/ui/tabs-skills.svg" alt="Skills">
      </a>
      <a class="tab-btn" data-tab="gear" title="Gear">
        <img class="tab-empty" src="systems/cyberpunk/img/ui/tabs-gear-empty.svg" alt="Gear">
        <img class="tab-filled" src="systems/cyberpunk/img/ui/tabs-gear.svg" alt="Gear">
      </a>
      <a class="tab-btn" data-tab="cyber" title="Cyberware">
        <img class="tab-empty" src="systems/cyberpunk/img/ui/tabs-cyber-empty.svg" alt="Cyberware">
        <img class="tab-filled" src="systems/cyberpunk/img/ui/tabs-cyber.svg" alt="Cyberware">
      </a>
      <a class="tab-btn" data-tab="net" title="Netrunning">
        <img class="tab-empty" src="systems/cyberpunk/img/ui/tabs-net-empty.svg" alt="Netrunning">
        <img class="tab-filled" src="systems/cyberpunk/img/ui/tabs-net.svg" alt="Netrunning">
      </a>
      <a class="tab-btn" data-tab="state" title="State">
        <img class="tab-empty" src="systems/cyberpunk/img/ui/tabs-state-empty.svg" alt="State">
        <img class="tab-filled" src="systems/cyberpunk/img/ui/tabs-state.svg" alt="State">
      </a>
    </nav>
  </div>
</form>
