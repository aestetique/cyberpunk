<form class="item-card program-card has-stats {{#unless isLocked}}unlocked{{/unless}}" autocomplete="off">
  {{!-- Header (38px) --}}
  <header class="sheet-header">
    <button class="lock-toggle" type="button" title="{{#if isLocked}}Unlock{{else}}Lock{{/if}} Sheet">
      <img src="systems/cp2020/img/ui/{{#if isLocked}}lock{{else}}unlock{{/if}}.svg" alt="">
    </button>

    <span class="header-name">{{item.name}}</span>

    <a class="header-control" data-action="copyUuid" title="Copy UUID">
      <i class="fas fa-passport"></i>
    </a>
    <a class="header-control close" data-action="closeSheet" title="Close">
      <i class="fas fa-times"></i>
    </a>
  </header>

  {{!-- Item Content --}}
  <div class="item-content">
    {{!-- Item Trivia (460×80px) --}}
    <div class="item-trivia">
      {{!-- Portrait (80×80px) --}}
      <div class="item-portrait">
        <img src="{{item.img}}" alt="{{item.name}}">
      </div>

      {{!-- Name+Category Container --}}
      <div class="item-identity">
        <input type="text" class="item-name" name="name" value="{{item.name}}" {{#if isLocked}}readonly{{/if}}>
        <div class="item-category">
          <div class="category-icon">
            <img src="systems/cp2020/img/ui/badge-program.svg" alt="">
          </div>
          <span class="category-label">{{localize "CYBERPUNK.Program"}}</span>
        </div>
      </div>

      {{!-- Stats Block (90×80px) --}}
      <div class="item-stats">
        {{!-- Price Row --}}
        <div class="stat-row">
          {{#if isLocked}}
            <span class="stat-value">{{toFixed system.cost 2}}</span>
          {{else}}
            <input type="number" class="stat-value" name="system.cost" value="{{system.cost}}" step="0.01">
          {{/if}}
          <div class="stat-icon">
            <img src="systems/cp2020/img/ui/badge-eurodollar.svg" alt="Price">
          </div>
        </div>

        {{!-- Weight Row --}}
        <div class="stat-row">
          {{#if isLocked}}
            <span class="stat-value">{{toFixed system.weight 2}} kg</span>
          {{else}}
            <input type="number" class="stat-value" name="system.weight" value="{{system.weight}}" step="0.01">
          {{/if}}
          <div class="stat-icon">
            <img src="systems/cp2020/img/ui/badge-weight.svg" alt="Weight">
          </div>
        </div>

        {{!-- Availability Row --}}
        <div class="stat-row">
          {{#if isLocked}}
            <span class="stat-value">{{selectedAvailabilityLabel}}</span>
          {{else}}
            <div class="dropdown-wrapper">
              <select class="stat-value" name="system.availability">
                {{#each availabilityOptions}}
                  <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                {{/each}}
              </select>
              <div class="dropdown-chevron">
                <img src="systems/cp2020/img/ui/icon-down.svg" alt="">
              </div>
            </div>
          {{/if}}
          <div class="stat-icon">
            <img src="systems/cp2020/img/ui/badge-rarity.svg" alt="Availability">
          </div>
        </div>
      </div>
    </div>

    {{!-- Horizontal Divider --}}
    <div class="divider"></div>

    {{!-- Content (single view, no tabs) --}}
    <div class="tab-content">
      {{!-- Variables Row: Class + Strength / MU --}}
      <div class="variables-row">
        <div class="variable-field">
          <label class="variable-label">{{localize "CYBERPUNK.ProgramTypeLabel"}}</label>
          {{#if isLocked}}
            <div class="dropdown">
              <span class="dropdown-text">{{selectedProgramClassLabel}}</span>
              <div class="dropdown-chevron">
                <img src="systems/cp2020/img/ui/icon-down.svg" alt="">
              </div>
            </div>
          {{else}}
            <div class="dropdown-wrapper">
              <select class="dropdown-select" name="system.programType">
                {{#each programClassOptions}}
                  <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                {{/each}}
              </select>
              <div class="dropdown-chevron">
                <img src="systems/cp2020/img/ui/icon-down.svg" alt="">
              </div>
            </div>
          {{/if}}
        </div>

        <div class="variable-field dual-field">
          <label class="variable-label">{{localize "CYBERPUNK.ProgramStrength"}}</label>
          {{#if isLocked}}
            <span class="dual-value">{{system.power}}</span>
          {{else}}
            <input type="number" class="dual-input" name="system.power" value="{{system.power}}">
          {{/if}}
          <label class="dual-separator">{{localize "CYBERPUNK.MU"}}</label>
          {{#if isLocked}}
            <span class="dual-value dual-value-narrow">{{system.mu}}</span>
          {{else}}
            <input type="number" class="dual-input dual-input-narrow" name="system.mu" value="{{system.mu}}" min="0">
          {{/if}}
        </div>
      </div>

      {{!-- Flavour Text --}}
      <div class="flavour-section">
        {{#if isLocked}}
          <p class="flavour-text">{{system.flavor}}</p>
        {{else}}
          <textarea class="flavour-text" name="system.flavor" placeholder="Program description...">{{system.flavor}}</textarea>
        {{/if}}
      </div>

      {{!-- Source Field --}}
      <div class="source-field">
        <label class="variable-label">{{localize "CYBERPUNK.Source"}}</label>
        <input type="text" class="source-input" name="system.source" value="{{system.source}}" placeholder="Core Rulebook, p.XX" {{#if isLocked}}readonly{{/if}}>
      </div>
    </div>
  </div>
</form>
